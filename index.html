<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0b0b;
            overscroll-behavior-y: contain;
        }

        .chat-container {
            height: calc(100vh - 80px);
        }

        .message-appear {
            animation: fadeInUp 0.3s ease-out forwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-dot {
            animation: blink 1.4s infinite both;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(23, 23, 23, 0.8);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }
    </style>
</head>
<body class="text-gray-100 flex flex-col h-screen">

    <!-- Header -->
    <header class="p-4 border-b border-white/10 flex items-center justify-between bg-[#0b0b0b] sticky top-0 z-10">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-600 to-purple-600 flex items-center justify-center">
                <i class="fa-solid fa-bolt text-white"></i>
            </div>
            <div>
                <h1 class="font-semibold text-lg">Gemini 2.5</h1>
                <p class="text-xs text-green-400 flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span> Online
                </p>
            </div>
        </div>
        <button onclick="clearChat()" class="text-gray-400 hover:text-white transition-colors">
            <i class="fa-solid fa-trash-can"></i>
        </button>
    </header>

    <!-- Chat Body -->
    <main id="chat-window" class="flex-1 overflow-y-auto p-4 space-y-6 chat-container">
        <!-- Initial Welcome Message -->
        <div class="flex flex-col items-center justify-center h-full text-center space-y-4 text-gray-500" id="welcome-screen">
            <i class="fa-solid fa-robot text-5xl mb-2 text-blue-500/50"></i>
            <h2 class="text-xl font-medium text-gray-300">How can I help you today?</h2>
            <p class="max-w-xs text-sm px-4">Ask anything! I can write code, explain math, or just chat.</p>
        </div>
    </main>

    <!-- Typing Indicator (Hidden by default) -->
    <div id="typing-indicator" class="px-6 py-2 hidden">
        <div class="flex items-center gap-2 text-gray-400 text-sm italic">
            <span>Gemini is thinking</span>
            <div class="flex gap-1">
                <span class="typing-dot">.</span>
                <span class="typing-dot">.</span>
                <span class="typing-dot">.</span>
            </div>
        </div>
    </div>

    <!-- Input Footer -->
    <footer class="glass p-4 sticky bottom-0">
        <div class="max-w-3xl mx-auto flex items-end gap-2 bg-[#1f1f1f] rounded-2xl p-2 border border-white/5 focus-within:border-blue-500/50 transition-all">
            <textarea 
                id="user-input"
                rows="1"
                placeholder="Message Gemini..." 
                class="flex-1 bg-transparent border-none focus:ring-0 text-white p-2 resize-none max-h-32 text-sm leading-relaxed"
                oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
            ></textarea>
            <button 
                id="send-btn"
                onclick="handleSendMessage()" 
                class="bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed w-10 h-10 rounded-xl flex items-center justify-center transition-all shrink-0 shadow-lg shadow-blue-900/20"
            >
                <i class="fa-solid fa-arrow-up text-white"></i>
            </button>
        </div>
    </footer>

    <script>
        // --- API CONFIGURATION ---
        const apiKey = "AIzaSyBtWTgXoxKKaLovtamEwa_6zpZCfPZTpvE"; // <--- PASTE YOUR API KEY HERE
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const welcomeScreen = document.getElementById('welcome-screen');
        const typingIndicator = document.getElementById('typing-indicator');
        const sendBtn = document.getElementById('send-btn');

        let chatHistory = [];

        function addMessage(text, isUser = false) {
            if (welcomeScreen) welcomeScreen.remove();

            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} message-appear`;

            const innerContent = `
                <div class="max-w-[85%] px-4 py-3 rounded-2xl ${isUser ? 'bg-blue-600 text-white rounded-br-none' : 'bg-[#1f1f1f] text-gray-100 rounded-bl-none'}">
                    <p class="text-[15px] leading-relaxed whitespace-pre-wrap">${escapeHtml(text)}</p>
                </div>
            `;

            messageDiv.innerHTML = innerContent;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        async function handleSendMessage() {
            const prompt = userInput.value.trim();
            if (!prompt || !apiKey) {
                if (!apiKey) alertUser("Please add your API Key in the code first!");
                return;
            }

            // Clear input and UI updates
            userInput.value = '';
            userInput.style.height = 'auto';
            addMessage(prompt, true);
            showLoading(true);

            // Add to internal history
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            // Exponential Backoff Retry logic
            let retries = 0;
            const maxRetries = 5;
            let success = false;

            while (retries < maxRetries && !success) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: chatHistory })
                    });

                    if (!response.ok) throw new Error("API Error");

                    const data = await response.json();
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't process that.";
                    
                    showLoading(false);
                    addMessage(aiText, false);
                    chatHistory.push({ role: "model", parts: [{ text: aiText }] });
                    success = true;

                } catch (error) {
                    retries++;
                    const delay = Math.pow(2, retries) * 1000;
                    if (retries === maxRetries) {
                        showLoading(false);
                        addMessage("Failed to connect to Gemini. Please check your internet or API key.", false);
                    } else {
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
        }

        function showLoading(show) {
            typingIndicator.classList.toggle('hidden', !show);
            sendBtn.disabled = show;
        }

        function clearChat() {
            chatWindow.innerHTML = '';
            chatHistory = [];
            location.reload(); // Refresh to bring back welcome screen
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function alertUser(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed top-20 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-2 rounded-full shadow-xl z-50 text-sm animate-bounce";
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // Enter key to send (Shift+Enter for newline)
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && window.innerWidth > 768) {
                e.preventDefault();
                handleSendMessage();
            }
        });
    </script>
</body>
</html>

